var Edgemesh=function(){"use strict";function t(){const t=new Uint8Array(8);crypto.getRandomValues(t);const e=new ArrayBuffer(4);let r=new DataView(e);r.setUint32(0,Date.now(),!1),r=new Uint8Array(r.buffer);for(let i=0;i<4;i++)t[i]=r[i];return function(t){const e=[],r=new DataView(t);for(let i=0;i<r.byteLength;i+=4){const t="00000000",s=(t+r.getUint32(i).toString(16)).slice(-t.length);e.push(s)}return`0x${e.join("")}`}(t.buffer)}try{self.edgemesh.v["edgemesh:core:4.2.0"]=1}catch(bt){}var e={debug:0,log:1,warn:2,error:3,silent:4},r="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function i(t,e){return t(e={exports:{}},e.exports),e.exports}var s={UINT32:i((function(t){!function(e){function r(t,e){return this instanceof r?(this._low=0,this._high=0,this.remainder=null,void 0===e?s.call(this,t):"string"==typeof t?o.call(this,t,e):void i.call(this,t,e)):new r(t,e)}function i(t,e){return this._low=0|t,this._high=0|e,this}function s(t){return this._low=65535&t,this._high=t>>>16,this}function o(t,e){var r=parseInt(t,e||10);return this._low=65535&r,this._high=r>>>16,this}r(Math.pow(36,5)),r(Math.pow(16,7)),r(Math.pow(10,9)),r(Math.pow(2,30)),r(36),r(16),r(10),r(2),r.prototype.fromBits=i,r.prototype.fromNumber=s,r.prototype.fromString=o,r.prototype.toNumber=function(){return 65536*this._high+this._low},r.prototype.toString=function(t){return this.toNumber().toString(t||10)},r.prototype.add=function(t){var e=this._low+t._low,r=e>>>16;return r+=this._high+t._high,this._low=65535&e,this._high=65535&r,this},r.prototype.subtract=function(t){return this.add(t.clone().negate())},r.prototype.multiply=function(t){var e,r,i=this._high,s=this._low,o=t._high,n=t._low;return e=(r=s*n)>>>16,e+=i*n,e&=65535,e+=s*o,this._low=65535&r,this._high=65535&e,this},r.prototype.div=function(t){if(0==t._low&&0==t._high)throw Error("division by zero");if(0==t._high&&1==t._low)return this.remainder=new r(0),this;if(t.gt(this))return this.remainder=this.clone(),this._low=0,this._high=0,this;if(this.eq(t))return this.remainder=new r(0),this._low=1,this._high=0,this;for(var e=t.clone(),i=-1;!this.lt(e);)e.shiftLeft(1,!0),i++;for(this.remainder=this.clone(),this._low=0,this._high=0;i>=0;i--)e.shiftRight(1),this.remainder.lt(e)||(this.remainder.subtract(e),i>=16?this._high|=1<<i-16:this._low|=1<<i);return this},r.prototype.negate=function(){var t=1+(65535&~this._low);return this._low=65535&t,this._high=~this._high+(t>>>16)&65535,this},r.prototype.equals=r.prototype.eq=function(t){return this._low==t._low&&this._high==t._high},r.prototype.greaterThan=r.prototype.gt=function(t){return this._high>t._high||!(this._high<t._high)&&this._low>t._low},r.prototype.lessThan=r.prototype.lt=function(t){return this._high<t._high||!(this._high>t._high)&&this._low<t._low},r.prototype.or=function(t){return this._low|=t._low,this._high|=t._high,this},r.prototype.and=function(t){return this._low&=t._low,this._high&=t._high,this},r.prototype.not=function(){return this._low=65535&~this._low,this._high=65535&~this._high,this},r.prototype.xor=function(t){return this._low^=t._low,this._high^=t._high,this},r.prototype.shiftRight=r.prototype.shiftr=function(t){return t>16?(this._low=this._high>>t-16,this._high=0):16==t?(this._low=this._high,this._high=0):(this._low=this._low>>t|this._high<<16-t&65535,this._high>>=t),this},r.prototype.shiftLeft=r.prototype.shiftl=function(t,e){return t>16?(this._high=this._low<<t-16,this._low=0,e||(this._high&=65535)):16==t?(this._high=this._low,this._low=0):(this._high=this._high<<t|this._low>>16-t,this._low=this._low<<t&65535,e||(this._high&=65535)),this},r.prototype.rotateLeft=r.prototype.rotl=function(t){var e=this._high<<16|this._low;return e=e<<t|e>>>32-t,this._low=65535&e,this._high=e>>>16,this},r.prototype.rotateRight=r.prototype.rotr=function(t){var e=this._high<<16|this._low;return e=e>>>t|e<<32-t,this._low=65535&e,this._high=e>>>16,this},r.prototype.clone=function(){return new r(this._low,this._high)},t.exports?t.exports=r:e.UINT32=r}(r)})),UINT64:i((function(t){!function(e){var r={16:s(Math.pow(16,5)),10:s(Math.pow(10,5)),2:s(Math.pow(2,5))},i={16:s(16),10:s(10),2:s(2)};function s(t,e,r,i){return this instanceof s?(this.remainder=null,"string"==typeof t?a.call(this,t,e):void 0===e?n.call(this,t):void o.apply(this,arguments)):new s(t,e,r,i)}function o(t,e,r,i){return void 0===r?(this._a00=65535&t,this._a16=t>>>16,this._a32=65535&e,this._a48=e>>>16,this):(this._a00=0|t,this._a16=0|e,this._a32=0|r,this._a48=0|i,this)}function n(t){return this._a00=65535&t,this._a16=t>>>16,this._a32=0,this._a48=0,this}function a(t,e){e=e||10,this._a00=0,this._a16=0,this._a32=0,this._a48=0;for(var i=r[e]||new s(Math.pow(e,5)),o=0,n=t.length;o<n;o+=5){var a=Math.min(5,n-o),h=parseInt(t.slice(o,o+a),e);this.multiply(a<5?new s(Math.pow(e,a)):i).add(new s(h))}return this}s.prototype.fromBits=o,s.prototype.fromNumber=n,s.prototype.fromString=a,s.prototype.toNumber=function(){return 65536*this._a16+this._a00},s.prototype.toString=function(t){var e=i[t=t||10]||new s(t);if(!this.gt(e))return this.toNumber().toString(t);for(var r=this.clone(),o=new Array(64),n=63;n>=0&&(r.div(e),o[n]=r.remainder.toNumber().toString(t),r.gt(e));n--);return o[n-1]=r.toNumber().toString(t),o.join("")},s.prototype.add=function(t){var e=this._a00+t._a00,r=e>>>16,i=(r+=this._a16+t._a16)>>>16,s=(i+=this._a32+t._a32)>>>16;return s+=this._a48+t._a48,this._a00=65535&e,this._a16=65535&r,this._a32=65535&i,this._a48=65535&s,this},s.prototype.subtract=function(t){return this.add(t.clone().negate())},s.prototype.multiply=function(t){var e=this._a00,r=this._a16,i=this._a32,s=this._a48,o=t._a00,n=t._a16,a=t._a32,h=e*o,c=h>>>16,l=(c+=e*n)>>>16;c&=65535,l+=(c+=r*o)>>>16;var d=(l+=e*a)>>>16;return l&=65535,d+=(l+=r*n)>>>16,l&=65535,d+=(l+=i*o)>>>16,d+=e*t._a48,d&=65535,d+=r*a,d&=65535,d+=i*n,d&=65535,d+=s*o,this._a00=65535&h,this._a16=65535&c,this._a32=65535&l,this._a48=65535&d,this},s.prototype.div=function(t){if(0==t._a16&&0==t._a32&&0==t._a48){if(0==t._a00)throw Error("division by zero");if(1==t._a00)return this.remainder=new s(0),this}if(t.gt(this))return this.remainder=this.clone(),this._a00=0,this._a16=0,this._a32=0,this._a48=0,this;if(this.eq(t))return this.remainder=new s(0),this._a00=1,this._a16=0,this._a32=0,this._a48=0,this;for(var e=t.clone(),r=-1;!this.lt(e);)e.shiftLeft(1,!0),r++;for(this.remainder=this.clone(),this._a00=0,this._a16=0,this._a32=0,this._a48=0;r>=0;r--)e.shiftRight(1),this.remainder.lt(e)||(this.remainder.subtract(e),r>=48?this._a48|=1<<r-48:r>=32?this._a32|=1<<r-32:r>=16?this._a16|=1<<r-16:this._a00|=1<<r);return this},s.prototype.negate=function(){var t=1+(65535&~this._a00);return this._a00=65535&t,t=(65535&~this._a16)+(t>>>16),this._a16=65535&t,t=(65535&~this._a32)+(t>>>16),this._a32=65535&t,this._a48=~this._a48+(t>>>16)&65535,this},s.prototype.equals=s.prototype.eq=function(t){return this._a48==t._a48&&this._a00==t._a00&&this._a32==t._a32&&this._a16==t._a16},s.prototype.greaterThan=s.prototype.gt=function(t){return this._a48>t._a48||!(this._a48<t._a48)&&(this._a32>t._a32||!(this._a32<t._a32)&&(this._a16>t._a16||!(this._a16<t._a16)&&this._a00>t._a00))},s.prototype.lessThan=s.prototype.lt=function(t){return this._a48<t._a48||!(this._a48>t._a48)&&(this._a32<t._a32||!(this._a32>t._a32)&&(this._a16<t._a16||!(this._a16>t._a16)&&this._a00<t._a00))},s.prototype.or=function(t){return this._a00|=t._a00,this._a16|=t._a16,this._a32|=t._a32,this._a48|=t._a48,this},s.prototype.and=function(t){return this._a00&=t._a00,this._a16&=t._a16,this._a32&=t._a32,this._a48&=t._a48,this},s.prototype.xor=function(t){return this._a00^=t._a00,this._a16^=t._a16,this._a32^=t._a32,this._a48^=t._a48,this},s.prototype.not=function(){return this._a00=65535&~this._a00,this._a16=65535&~this._a16,this._a32=65535&~this._a32,this._a48=65535&~this._a48,this},s.prototype.shiftRight=s.prototype.shiftr=function(t){return(t%=64)>=48?(this._a00=this._a48>>t-48,this._a16=0,this._a32=0,this._a48=0):t>=32?(t-=32,this._a00=65535&(this._a32>>t|this._a48<<16-t),this._a16=this._a48>>t&65535,this._a32=0,this._a48=0):t>=16?(t-=16,this._a00=65535&(this._a16>>t|this._a32<<16-t),this._a16=65535&(this._a32>>t|this._a48<<16-t),this._a32=this._a48>>t&65535,this._a48=0):(this._a00=65535&(this._a00>>t|this._a16<<16-t),this._a16=65535&(this._a16>>t|this._a32<<16-t),this._a32=65535&(this._a32>>t|this._a48<<16-t),this._a48=this._a48>>t&65535),this},s.prototype.shiftLeft=s.prototype.shiftl=function(t,e){return(t%=64)>=48?(this._a48=this._a00<<t-48,this._a32=0,this._a16=0,this._a00=0):t>=32?(t-=32,this._a48=this._a16<<t|this._a00>>16-t,this._a32=this._a00<<t&65535,this._a16=0,this._a00=0):t>=16?(t-=16,this._a48=this._a32<<t|this._a16>>16-t,this._a32=65535&(this._a16<<t|this._a00>>16-t),this._a16=this._a00<<t&65535,this._a00=0):(this._a48=this._a48<<t|this._a32>>16-t,this._a32=65535&(this._a32<<t|this._a16>>16-t),this._a16=65535&(this._a16<<t|this._a00>>16-t),this._a00=this._a00<<t&65535),e||(this._a48&=65535),this},s.prototype.rotateLeft=s.prototype.rotl=function(t){if(0==(t%=64))return this;if(t>=32){var e=this._a00;if(this._a00=this._a32,this._a32=e,e=this._a48,this._a48=this._a16,this._a16=e,32==t)return this;t-=32}var r=this._a48<<16|this._a32,i=this._a16<<16|this._a00,s=r<<t|i>>>32-t,o=i<<t|r>>>32-t;return this._a00=65535&o,this._a16=o>>>16,this._a32=65535&s,this._a48=s>>>16,this},s.prototype.rotateRight=s.prototype.rotr=function(t){if(0==(t%=64))return this;if(t>=32){var e=this._a00;if(this._a00=this._a32,this._a32=e,e=this._a48,this._a48=this._a16,this._a16=e,32==t)return this;t-=32}var r=this._a48<<16|this._a32,i=this._a16<<16|this._a00,s=r>>>t|i<<32-t,o=i>>>t|r<<32-t;return this._a00=65535&o,this._a16=o>>>16,this._a32=65535&s,this._a48=s>>>16,this},s.prototype.clone=function(){return new s(this._a00,this._a16,this._a32,this._a48)},t.exports?t.exports=s:e.UINT64=s}(r)}))},o=s.UINT32;o.prototype.xxh_update=function(t,e){var r,i,s=a._low,o=a._high;r=(i=t*s)>>>16,r+=e*s,r&=65535,r+=t*o;var h=this._low+(65535&i),c=h>>>16,l=(c+=this._high+(65535&r))<<16|65535&h;c=(l=l<<13|l>>>19)>>>16,r=(i=(h=65535&l)*(s=n._low))>>>16,r+=c*s,r&=65535,r+=h*(o=n._high),this._low=65535&i,this._high=65535&r};var n=o("2654435761"),a=o("2246822519"),h=o("3266489917"),c=o("668265263"),l=o("374761393");function d(){return 2==arguments.length?new d(arguments[1]).update(arguments[0]).digest():this instanceof d?void u.call(this,arguments[0]):new d(arguments[0])}function u(t){return this.seed=t instanceof o?t.clone():o(t),this.v1=this.seed.clone().add(n).add(a),this.v2=this.seed.clone().add(a),this.v3=this.seed.clone(),this.v4=this.seed.clone().subtract(n),this.total_len=0,this.memsize=0,this.memory=null,this}d.prototype.init=u,d.prototype.update=function(t){var e,r="string"==typeof t;r&&(t=function(t){for(var e=[],r=0,i=t.length;r<i;r++){var s=t.charCodeAt(r);s<128?e.push(s):s<2048?e.push(192|s>>6,128|63&s):s<55296||s>=57344?e.push(224|s>>12,128|s>>6&63,128|63&s):(r++,s=65536+((1023&s)<<10|1023&t.charCodeAt(r)),e.push(240|s>>18,128|s>>12&63,128|s>>6&63,128|63&s))}return new Uint8Array(e)}(t),r=!1,e=!0),"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer&&(e=!0,t=new Uint8Array(t));var i=0,s=t.length,o=i+s;if(0==s)return this;if(this.total_len+=s,0==this.memsize&&(this.memory=r?"":e?new Uint8Array(16):new Buffer(16)),this.memsize+s<16)return r?this.memory+=t:e?this.memory.set(t.subarray(0,s),this.memsize):t.copy(this.memory,this.memsize,0,s),this.memsize+=s,this;if(this.memsize>0){r?this.memory+=t.slice(0,16-this.memsize):e?this.memory.set(t.subarray(0,16-this.memsize),this.memsize):t.copy(this.memory,this.memsize,0,16-this.memsize);var n=0;r?(this.v1.xxh_update(this.memory.charCodeAt(n+1)<<8|this.memory.charCodeAt(n),this.memory.charCodeAt(n+3)<<8|this.memory.charCodeAt(n+2)),n+=4,this.v2.xxh_update(this.memory.charCodeAt(n+1)<<8|this.memory.charCodeAt(n),this.memory.charCodeAt(n+3)<<8|this.memory.charCodeAt(n+2)),n+=4,this.v3.xxh_update(this.memory.charCodeAt(n+1)<<8|this.memory.charCodeAt(n),this.memory.charCodeAt(n+3)<<8|this.memory.charCodeAt(n+2)),n+=4,this.v4.xxh_update(this.memory.charCodeAt(n+1)<<8|this.memory.charCodeAt(n),this.memory.charCodeAt(n+3)<<8|this.memory.charCodeAt(n+2))):(this.v1.xxh_update(this.memory[n+1]<<8|this.memory[n],this.memory[n+3]<<8|this.memory[n+2]),n+=4,this.v2.xxh_update(this.memory[n+1]<<8|this.memory[n],this.memory[n+3]<<8|this.memory[n+2]),n+=4,this.v3.xxh_update(this.memory[n+1]<<8|this.memory[n],this.memory[n+3]<<8|this.memory[n+2]),n+=4,this.v4.xxh_update(this.memory[n+1]<<8|this.memory[n],this.memory[n+3]<<8|this.memory[n+2])),i+=16-this.memsize,this.memsize=0,r&&(this.memory="")}if(i<=o-16){var a=o-16;do{r?(this.v1.xxh_update(t.charCodeAt(i+1)<<8|t.charCodeAt(i),t.charCodeAt(i+3)<<8|t.charCodeAt(i+2)),i+=4,this.v2.xxh_update(t.charCodeAt(i+1)<<8|t.charCodeAt(i),t.charCodeAt(i+3)<<8|t.charCodeAt(i+2)),i+=4,this.v3.xxh_update(t.charCodeAt(i+1)<<8|t.charCodeAt(i),t.charCodeAt(i+3)<<8|t.charCodeAt(i+2)),i+=4,this.v4.xxh_update(t.charCodeAt(i+1)<<8|t.charCodeAt(i),t.charCodeAt(i+3)<<8|t.charCodeAt(i+2))):(this.v1.xxh_update(t[i+1]<<8|t[i],t[i+3]<<8|t[i+2]),i+=4,this.v2.xxh_update(t[i+1]<<8|t[i],t[i+3]<<8|t[i+2]),i+=4,this.v3.xxh_update(t[i+1]<<8|t[i],t[i+3]<<8|t[i+2]),i+=4,this.v4.xxh_update(t[i+1]<<8|t[i],t[i+3]<<8|t[i+2])),i+=4}while(i<=a)}return i<o&&(r?this.memory+=t.slice(i):e?this.memory.set(t.subarray(i,o),this.memsize):t.copy(this.memory,this.memsize,i,o),this.memsize=o-i),this},d.prototype.digest=function(){var t,e,r=this.memory,i="string"==typeof r,s=0,d=this.memsize,u=new o;for((t=this.total_len>=16?this.v1.rotl(1).add(this.v2.rotl(7).add(this.v3.rotl(12).add(this.v4.rotl(18)))):this.seed.clone().add(l)).add(u.fromNumber(this.total_len));s<=d-4;)i?u.fromBits(r.charCodeAt(s+1)<<8|r.charCodeAt(s),r.charCodeAt(s+3)<<8|r.charCodeAt(s+2)):u.fromBits(r[s+1]<<8|r[s],r[s+3]<<8|r[s+2]),t.add(u.multiply(h)).rotl(17).multiply(c),s+=4;for(;s<d;)u.fromBits(i?r.charCodeAt(s++):r[s++],0),t.add(u.multiply(l)).rotl(11).multiply(n);return e=t.clone().shiftRight(15),t.xor(e).multiply(a),e=t.clone().shiftRight(13),t.xor(e).multiply(h),e=t.clone().shiftRight(16),t.xor(e),this.init(this.seed),t};var m=d,p=s.UINT64,g=p("11400714785074694791"),f=p("14029467366897019727"),_=p("1609587929392839161"),y=p("9650029242287828579"),v=p("2870177450012600261");function w(){return 2==arguments.length?new w(arguments[1]).update(arguments[0]).digest():this instanceof w?void A.call(this,arguments[0]):new w(arguments[0])}function A(t){return this.seed=t instanceof p?t.clone():p(t),this.v1=this.seed.clone().add(g).add(f),this.v2=this.seed.clone().add(f),this.v3=this.seed.clone(),this.v4=this.seed.clone().subtract(g),this.total_len=0,this.memsize=0,this.memory=null,this}w.prototype.init=A,w.prototype.update=function(t){var e,r="string"==typeof t;r&&(t=function(t){for(var e=[],r=0,i=t.length;r<i;r++){var s=t.charCodeAt(r);s<128?e.push(s):s<2048?e.push(192|s>>6,128|63&s):s<55296||s>=57344?e.push(224|s>>12,128|s>>6&63,128|63&s):(r++,s=65536+((1023&s)<<10|1023&t.charCodeAt(r)),e.push(240|s>>18,128|s>>12&63,128|s>>6&63,128|63&s))}return new Uint8Array(e)}(t),r=!1,e=!0),"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer&&(e=!0,t=new Uint8Array(t));var i=0,s=t.length,o=i+s;if(0==s)return this;if(this.total_len+=s,0==this.memsize&&(this.memory=r?"":e?new Uint8Array(32):new Buffer(32)),this.memsize+s<32)return r?this.memory+=t:e?this.memory.set(t.subarray(0,s),this.memsize):t.copy(this.memory,this.memsize,0,s),this.memsize+=s,this;if(this.memsize>0){r?this.memory+=t.slice(0,32-this.memsize):e?this.memory.set(t.subarray(0,32-this.memsize),this.memsize):t.copy(this.memory,this.memsize,0,32-this.memsize);var n=0;if(r)h=p(this.memory.charCodeAt(n+1)<<8|this.memory.charCodeAt(n),this.memory.charCodeAt(n+3)<<8|this.memory.charCodeAt(n+2),this.memory.charCodeAt(n+5)<<8|this.memory.charCodeAt(n+4),this.memory.charCodeAt(n+7)<<8|this.memory.charCodeAt(n+6)),this.v1.add(h.multiply(f)).rotl(31).multiply(g),n+=8,h=p(this.memory.charCodeAt(n+1)<<8|this.memory.charCodeAt(n),this.memory.charCodeAt(n+3)<<8|this.memory.charCodeAt(n+2),this.memory.charCodeAt(n+5)<<8|this.memory.charCodeAt(n+4),this.memory.charCodeAt(n+7)<<8|this.memory.charCodeAt(n+6)),this.v2.add(h.multiply(f)).rotl(31).multiply(g),n+=8,h=p(this.memory.charCodeAt(n+1)<<8|this.memory.charCodeAt(n),this.memory.charCodeAt(n+3)<<8|this.memory.charCodeAt(n+2),this.memory.charCodeAt(n+5)<<8|this.memory.charCodeAt(n+4),this.memory.charCodeAt(n+7)<<8|this.memory.charCodeAt(n+6)),this.v3.add(h.multiply(f)).rotl(31).multiply(g),n+=8,h=p(this.memory.charCodeAt(n+1)<<8|this.memory.charCodeAt(n),this.memory.charCodeAt(n+3)<<8|this.memory.charCodeAt(n+2),this.memory.charCodeAt(n+5)<<8|this.memory.charCodeAt(n+4),this.memory.charCodeAt(n+7)<<8|this.memory.charCodeAt(n+6)),this.v4.add(h.multiply(f)).rotl(31).multiply(g);else h=p(this.memory[n+1]<<8|this.memory[n],this.memory[n+3]<<8|this.memory[n+2],this.memory[n+5]<<8|this.memory[n+4],this.memory[n+7]<<8|this.memory[n+6]),this.v1.add(h.multiply(f)).rotl(31).multiply(g),n+=8,h=p(this.memory[n+1]<<8|this.memory[n],this.memory[n+3]<<8|this.memory[n+2],this.memory[n+5]<<8|this.memory[n+4],this.memory[n+7]<<8|this.memory[n+6]),this.v2.add(h.multiply(f)).rotl(31).multiply(g),n+=8,h=p(this.memory[n+1]<<8|this.memory[n],this.memory[n+3]<<8|this.memory[n+2],this.memory[n+5]<<8|this.memory[n+4],this.memory[n+7]<<8|this.memory[n+6]),this.v3.add(h.multiply(f)).rotl(31).multiply(g),n+=8,h=p(this.memory[n+1]<<8|this.memory[n],this.memory[n+3]<<8|this.memory[n+2],this.memory[n+5]<<8|this.memory[n+4],this.memory[n+7]<<8|this.memory[n+6]),this.v4.add(h.multiply(f)).rotl(31).multiply(g);i+=32-this.memsize,this.memsize=0,r&&(this.memory="")}if(i<=o-32){var a=o-32;do{var h;if(r)h=p(t.charCodeAt(i+1)<<8|t.charCodeAt(i),t.charCodeAt(i+3)<<8|t.charCodeAt(i+2),t.charCodeAt(i+5)<<8|t.charCodeAt(i+4),t.charCodeAt(i+7)<<8|t.charCodeAt(i+6)),this.v1.add(h.multiply(f)).rotl(31).multiply(g),i+=8,h=p(t.charCodeAt(i+1)<<8|t.charCodeAt(i),t.charCodeAt(i+3)<<8|t.charCodeAt(i+2),t.charCodeAt(i+5)<<8|t.charCodeAt(i+4),t.charCodeAt(i+7)<<8|t.charCodeAt(i+6)),this.v2.add(h.multiply(f)).rotl(31).multiply(g),i+=8,h=p(t.charCodeAt(i+1)<<8|t.charCodeAt(i),t.charCodeAt(i+3)<<8|t.charCodeAt(i+2),t.charCodeAt(i+5)<<8|t.charCodeAt(i+4),t.charCodeAt(i+7)<<8|t.charCodeAt(i+6)),this.v3.add(h.multiply(f)).rotl(31).multiply(g),i+=8,h=p(t.charCodeAt(i+1)<<8|t.charCodeAt(i),t.charCodeAt(i+3)<<8|t.charCodeAt(i+2),t.charCodeAt(i+5)<<8|t.charCodeAt(i+4),t.charCodeAt(i+7)<<8|t.charCodeAt(i+6)),this.v4.add(h.multiply(f)).rotl(31).multiply(g);else h=p(t[i+1]<<8|t[i],t[i+3]<<8|t[i+2],t[i+5]<<8|t[i+4],t[i+7]<<8|t[i+6]),this.v1.add(h.multiply(f)).rotl(31).multiply(g),h=p(t[(i+=8)+1]<<8|t[i],t[i+3]<<8|t[i+2],t[i+5]<<8|t[i+4],t[i+7]<<8|t[i+6]),this.v2.add(h.multiply(f)).rotl(31).multiply(g),h=p(t[(i+=8)+1]<<8|t[i],t[i+3]<<8|t[i+2],t[i+5]<<8|t[i+4],t[i+7]<<8|t[i+6]),this.v3.add(h.multiply(f)).rotl(31).multiply(g),h=p(t[(i+=8)+1]<<8|t[i],t[i+3]<<8|t[i+2],t[i+5]<<8|t[i+4],t[i+7]<<8|t[i+6]),this.v4.add(h.multiply(f)).rotl(31).multiply(g);i+=8}while(i<=a)}return i<o&&(r?this.memory+=t.slice(i):e?this.memory.set(t.subarray(i,o),this.memsize):t.copy(this.memory,this.memsize,i,o),this.memsize=o-i),this},w.prototype.digest=function(){var t,e,r=this.memory,i="string"==typeof r,s=0,o=this.memsize,n=new p;for(this.total_len>=32?((t=this.v1.clone().rotl(1)).add(this.v2.clone().rotl(7)),t.add(this.v3.clone().rotl(12)),t.add(this.v4.clone().rotl(18)),t.xor(this.v1.multiply(f).rotl(31).multiply(g)),t.multiply(g).add(y),t.xor(this.v2.multiply(f).rotl(31).multiply(g)),t.multiply(g).add(y),t.xor(this.v3.multiply(f).rotl(31).multiply(g)),t.multiply(g).add(y),t.xor(this.v4.multiply(f).rotl(31).multiply(g)),t.multiply(g).add(y)):t=this.seed.clone().add(v),t.add(n.fromNumber(this.total_len));s<=o-8;)i?n.fromBits(r.charCodeAt(s+1)<<8|r.charCodeAt(s),r.charCodeAt(s+3)<<8|r.charCodeAt(s+2),r.charCodeAt(s+5)<<8|r.charCodeAt(s+4),r.charCodeAt(s+7)<<8|r.charCodeAt(s+6)):n.fromBits(r[s+1]<<8|r[s],r[s+3]<<8|r[s+2],r[s+5]<<8|r[s+4],r[s+7]<<8|r[s+6]),n.multiply(f).rotl(31).multiply(g),t.xor(n).rotl(27).multiply(g).add(y),s+=8;for(s+4<=o&&(i?n.fromBits(r.charCodeAt(s+1)<<8|r.charCodeAt(s),r.charCodeAt(s+3)<<8|r.charCodeAt(s+2),0,0):n.fromBits(r[s+1]<<8|r[s],r[s+3]<<8|r[s+2],0,0),t.xor(n.multiply(g)).rotl(23).multiply(f).add(_),s+=4);s<o;)n.fromBits(i?r.charCodeAt(s++):r[s++],0,0,0),t.xor(n.multiply(v)).rotl(11).multiply(g);return e=t.clone().shiftRight(33),t.xor(e).multiply(f),e=t.clone().shiftRight(29),t.xor(e).multiply(_),e=t.clone().shiftRight(32),t.xor(e),this.init(this.seed),t};var b={h32:m,h64:w}.h64;try{self.edgemesh.v["edgemesh:hash:4.2.0"]=1}catch(bt){}const C=(t,e={noPrefix:!1})=>`${e.noPrefix?"":"0x"}${b(t,0).toString(16).padStart(16,"0")}`,E=(t,e={noPrefix:!1,url:!1})=>{if(e.url){const r=new URL(t);return{originId:C(r.hostname,e),assetId:C(r.pathname+r.search)}}return C(t,e)};class S{constructor(){this.promise=new Promise(((t,e)=>{this.resolve=t,this.reject=e}))}}const T="undefined"!=typeof navigator&&/^((?!chrome|android).)*safari/i.test(navigator.userAgent);let L=e.warn,x="worker";const k=t=>L<=t,I=e.error,U=function(t,r,i){const s=0===t.indexOf("group")?I:e[t];if(!k(s))return;if(!i||"groupCollapsed"===t&&T)return void console[t](...r);const o=[`%c${x}`,`background: ${M[t]}; color: white; padding: 2px 0.5em; border-radius: 0.5em;`];console[t](...o,...r)},R=()=>{k(I)&&console.groupEnd()},D={groupEnd:R,unprefixed:{groupEnd:R}},M={debug:"#7f8c8d",log:"#3498db",warn:"#f39c12",error:"#c0392b",groupCollapsed:"#ae4292"};Object.keys(M).forEach((t=>(t=>{D[t]=(...e)=>U(t,e,!0),D.unprefixed[t]=(...e)=>U(t,e)})(t)));class N{constructor(t){this.title=t,this.logs=[],Object.keys(M).forEach((t=>{this[t]=(...e)=>this.logs.push({keyName:t,args:e})})),this.groupEnd=(...t)=>this.logs.push({keyName:"groupEnd",args:t})}end(){D.groupCollapsed(this.title);for(const{keyName:t,args:e}of this.logs)D.unprefixed[t](...e);D.groupEnd()}}D.LogGroup=N;const O={oneline:(t,...e)=>t.reduce(((t,r,i)=>t+r+(e[i]||"")),"").replace(/(?:\n(?:\s*))+/g," ").trim()};try{self.edgemesh.v["edgemesh:client:4.2.0"]=1}catch(bt){}class B{constructor(){this._eventListenerRegistry={}}addEventListener(t,e){this._getEventListenersByType(t).add(e)}removeEventListener(t,e){this._getEventListenersByType(t).remove(e)}dispatchEvent(t){t.target=this,this._getEventListenersByType(t.type).forEach((e=>e(t)))}_getEventListenersByType(t){return this._eventListenerRegistry[t]=this._eventListenerRegistry[t]||new Set,this._eventListenerRegistry[t]}}var z=(t,e)=>new URL(t,location).href===new URL(e,location).href;class F{constructor(t,e){Object.assign(this,e,{type:t})}}const{oneline:W}=O;class P extends B{constructor(t,e={}){super(),this._scriptURL=t,this._registerOptions=e,this._updateFoundCount=0,this._swDeferred=new S,this._activeDeferred=new S,this._controllingDeferred=new S,this._onMessage=this._onMessage.bind(this),this._onStateChange=this._onStateChange.bind(this),this._onUpdateFound=this._onUpdateFound.bind(this),this._onControllerChange=this._onControllerChange.bind(this)}async register({immediate:t=!1}={}){if(t||"complete"===document.readyState||await new Promise((t=>addEventListener("load",t))),this._isUpdate=Boolean(navigator.serviceWorker.controller),this._compatibleControllingSW=this._getControllingSWIfCompatible(),this._registration=await this._registerScript(),this._compatibleControllingSW&&(this._sw=this._compatibleControllingSW,this._swDeferred.resolve(this._compatibleControllingSW),this._activeDeferred.resolve(this._compatibleControllingSW),this._controllingDeferred.resolve(this._compatibleControllingSW),this._reportWindowReady(this._compatibleControllingSW),this._compatibleControllingSW.addEventListener("statechange",this._onStateChange,{once:!0})),this._registration&&this._registration.waiting&&z(this._registration.waiting.scriptURL,this._scriptURL)&&Promise.resolve().then((()=>{this.dispatchEvent(new F("waiting",{sw:this._registration.waiting,wasWaitingBeforeRegister:!0})),D.warn(W`
          A service worker was already waiting to activate
          before this script was registered.`)})),D.log(`Successfully registered service worker '${this._scriptURL}'.`),navigator.serviceWorker.controller){this._compatibleControllingSW?D.debug(W`
          A service worker with the same script URL
          is already controlling this page.`):D.debug(W`
          A service worker with a different script URL is
          currently controlling the page. The browser is now fetching
          the new script now.`);(()=>{const t=new URL(this._registerOptions.scope||this._scriptURL,document.baseURI),e=new URL("./",t.href).pathname;return!location.pathname.startsWith(e)})()&&D.warn(W`
          The current page is not in scope for the registered
          service worker. Was this a mistake?`)}if(this._registration)return this._registration.addEventListener("updatefound",this._onUpdateFound),navigator.serviceWorker.addEventListener("controllerchange",this._onControllerChange,{once:!0}),navigator.serviceWorker.addEventListener("message",this._onMessage),this._registration;throw new Error(`Service worker could not be registered at '${this._scriptURL}'.`)}static async unregister(){navigator.serviceWorker.getRegistrations().then((t=>{for(const e of t)e.unregister({immediate:!0})}))}get active(){return this._activeDeferred.promise}get controlling(){return this._controllingDeferred.promise}async getSW(){return this._sw||this._swDeferred.promise}async messageSW(t){const e=await this.getSW(),r=new MessageChannel;return new Promise(((i,s)=>{r.port1.onmessage=t=>i(t.data),e?e.postMessage(t,[r.port2]):s(new Error("Service Worker is not registered."))}))}async sync(t){if(this._registration)return this._registration.sync?this._registration.sync.register(t):this.messageSW({channel:"sync",data:t})}_getControllingSWIfCompatible(){const t=navigator.serviceWorker.controller;if(t&&z(t.scriptURL,this._scriptURL))return t}async _registerScript(){try{const t=await navigator.serviceWorker.register(this._scriptURL,this._registerOptions);return this._registrationTime=performance.now(),t}catch(t){throw t}}_reportWindowReady(t){this.dispatchEvent(new F("ready",t))}_onUpdateFound(){const t=this._registration.installing;!!(this._updateFoundCount>0||!z(t.scriptURL,this._scriptURL)||performance.now()>this._registrationTime+6e4)?(this._externalSW=t,this._registration.removeEventListener("updatefound",this._onUpdateFound)):(this._sw=t,this._swDeferred.resolve(t)),++this._updateFoundCount,t.addEventListener("statechange",this._onStateChange)}_onStateChange(t){const e=t.target,{state:r}=e,i=e===this._externalSW,s=i?"external":"",o={sw:e,originalEvent:t};switch(!i&&this._isUpdate&&(o.isUpdate=!0),this.dispatchEvent(new F(s+r,o)),"installed"===r?this._waitingTimeout=setTimeout((()=>{"installed"===r&&this._registration.waiting===e&&this.dispatchEvent(new F(s+"waiting",o))}),200):"activating"===r&&(clearTimeout(this._waitingTimeout),i||this._activeDeferred.resolve(e)),r){case"installed":i?D.warn(W`
            An external service worker has installed.
            You may want to suggest users reload this page.`):D.log("Registered service worker installed.");break;case"activated":i?D.warn("An external service worker has activated."):(D.log("Registered service worker activated."),e!==navigator.serviceWorker.controller&&D.warn(W`
              The registered service worker is active but
              not yet controlling the page. Reload or run
              'clients.claim()' in the service worker.`));break;case"redundant":e===this._compatibleControllingSW?D.log("Previously controlling service worker now redundant."):i||D.log("Registered service worker now redundant.")}}_onControllerChange(t){const e=this._sw;e===navigator.serviceWorker.controller&&(this.dispatchEvent(new F("controlling",{sw:e,originalEvent:t})),D.log("Registered service worker now controlling this page."),this._controllingDeferred.resolve(e))}_onMessage(t){const{data:e}=t;this.dispatchEvent(new F("message",{data:e,originalEvent:t}))}}class j extends B{constructor(){super(),this._onMessage=this._onMessage.bind(this),this._swDeferred=new S,navigator.serviceWorker&&navigator.serviceWorker.ready?navigator.serviceWorker.ready.then((t=>{this._registration=t,this._sw=navigator.serviceWorker.controller||t.active,this._swDeferred.resolve(this._sw),this._reportWindowReady(this._sw)})).catch((t=>{D.error(t)})):D.error(new Error("Service Worker is not supported by this browser."))}async getSW(){return this._sw||this._swDeferred.promise}async messageSW(t){const e=await this.getSW(),r=new MessageChannel;return new Promise(((i,s)=>{r.port1.onmessage=t=>i(t.data),e?e.postMessage(t,[r.port2]):s(new Error("Service Worker is not registered."))}))}async sync(t){if(this._registration)return this._registration.sync?this._registration.sync.register(t):this.messageSW({channel:"sync",data:t})}_onMessage(t){const{data:e}=t;this.dispatchEvent(new F("message",{data:e,originalEvent:t}))}_reportWindowReady(t){this.dispatchEvent(new F("ready",t))}}function G(t){const e=4294967296;let r,i,s=new Uint8Array(128),o=0;return n(t),s.subarray(0,o);function n(t){switch(typeof t){case"undefined":a();break;case"boolean":!function(t){c(t?195:194)}(t);break;case"number":!function(t){if(isFinite(t)&&Math.floor(t)===t)if(t>=0&&t<=127)c(t);else if(t<0&&t>=-32)c(t);else if(t>0&&t<=255)l([204,t]);else if(t>=-128&&t<=127)l([208,t]);else if(t>0&&t<=65535)l([205,t>>>8,t]);else if(t>=-32768&&t<=32767)l([209,t>>>8,t]);else if(t>0&&t<=4294967295)l([206,t>>>24,t>>>16,t>>>8,t]);else if(t>=-2147483648&&t<=2147483647)l([210,t>>>24,t>>>16,t>>>8,t]);else if(t>0&&t<=0x10000000000000000){const r=t/e,i=t%e;l([211,r>>>24,r>>>16,r>>>8,r,i>>>24,i>>>16,i>>>8,i])}else t>=-0x8000000000000000&&t<=0x8000000000000000?(c(211),d(t)):l(t<0?[211,128,0,0,0,0,0,0,0]:[207,255,255,255,255,255,255,255,255]);else i||(r=new ArrayBuffer(8),i=new DataView(r)),i.setFloat64(0,t),c(203),l(new Uint8Array(r))}(t);break;case"string":!function(t){const e=function(t){let e=!0;const r=t.length;for(let o=0;o<r;o++)if(t.charCodeAt(o)>127){e=!1;break}let i=0;const s=new Uint8Array(t.length*(e?1:4));for(let o=0;o!==r;o++){let e=t.charCodeAt(o);if(e<128)s[i++]=e;else{if(e<2048)s[i++]=e>>6|192;else{if(e>55295&&e<56320){if(++o>=r)throw new Error("UTF-8 encode: incomplete surrogate pair");const n=t.charCodeAt(o);if(n<56320||n>57343)throw new Error("UTF-8 encode: second surrogate character 0x"+n.toString(16)+" at index "+o+" out of range");e=65536+((1023&e)<<10)+(1023&n),s[i++]=e>>18|240,s[i++]=e>>12&63|128}else s[i++]=e>>12|224;s[i++]=e>>6&63|128}s[i++]=63&e|128}}return e?s:s.subarray(0,i)}(t),r=e.length;r<=31?c(160+r):l(r<=255?[217,r]:r<=65535?[218,r>>>8,r]:[219,r>>>24,r>>>16,r>>>8,r]);l(e)}(t);break;case"object":null===t?a():t instanceof Date?function(t){const r=t.getTime()/1e3;if(0===t.getMilliseconds()&&r>=0&&r<4294967296)l([214,255,r>>>24,r>>>16,r>>>8,r]);else if(r>=0&&r<17179869184){const i=1e6*t.getMilliseconds();l([215,255,i>>>22,i>>>14,i>>>6,i<<2>>>0|r/e,r>>>24,r>>>16,r>>>8,r])}else{const e=1e6*t.getMilliseconds();l([199,12,255,e>>>24,e>>>16,e>>>8,e]),d(r)}}(t):Array.isArray(t)?h(t):t instanceof Uint8Array||t instanceof Uint8ClampedArray?function(t){const e=t.length;l(e<=15?[196,e]:e<=65535?[197,e>>>8,e]:[198,e>>>24,e>>>16,e>>>8,e]);l(t)}(t):t instanceof Int8Array||t instanceof Int16Array||t instanceof Uint16Array||t instanceof Int32Array||t instanceof Uint32Array||t instanceof Float32Array||t instanceof Float64Array?h(t):function(t){let e=0;for(const r in t)e++;e<=15?c(128+e):l(e<=65535?[222,e>>>8,e]:[223,e>>>24,e>>>16,e>>>8,e]);for(const r in t)n(r),n(t[r])}(t)}}function a(t){c(192)}function h(t){const e=t.length;e<=15?c(144+e):l(e<=65535?[220,e>>>8,e]:[221,e>>>24,e>>>16,e>>>8,e]);for(let r=0;r<e;r++)n(t[r])}function c(t){if(s.length<o+1){let t=2*s.length;for(;t<o+1;)t*=2;const e=new Uint8Array(t);e.set(s),s=e}s[o]=t,o++}function l(t){if(s.length<o+t.length){let e=2*s.length;for(;e<o+t.length;)e*=2;const r=new Uint8Array(e);r.set(s),s=r}s.set(t,o),o+=t.length}function d(t){let r,i;t>=0?(r=t/e,i=t%e):(t++,r=Math.abs(t)/e,i=Math.abs(t)%e,r=~r,i=~i),l([r>>>24,r>>>16,r>>>8,r,i>>>24,i>>>16,i>>>8,i])}}function $(t){const e=4294967296;let r=0;if(t instanceof ArrayBuffer&&(t=new Uint8Array(t)),"object"!=typeof t||void 0===t.length)throw new Error("Invalid argument type: Expected a byte array (Array or Uint8Array) to deserialize.");if(!t.length)throw new Error("Invalid argument: The byte array to deserialize is empty.");t instanceof Uint8Array||(t=new Uint8Array(t));const i=s();return t.length,i;function s(){const e=t[r++];if(e>=0&&e<=127)return e;if(e>=128&&e<=143)return c(e-128);if(e>=144&&e<=159)return l(e-144);if(e>=160&&e<=191)return d(e-160);if(192===e)return null;if(193===e)throw new Error("Invalid byte code 0xc1 found.");if(194===e)return!1;if(195===e)return!0;if(196===e)return h(-1,1);if(197===e)return h(-1,2);if(198===e)return h(-1,4);if(199===e)return u(-1,1);if(200===e)return u(-1,2);if(201===e)return u(-1,4);if(202===e)return a(4);if(203===e)return a(8);if(204===e)return n(1);if(205===e)return n(2);if(206===e)return n(4);if(207===e)return n(8);if(208===e)return o(1);if(209===e)return o(2);if(210===e)return o(4);if(211===e)return o(8);if(212===e)return u(1);if(213===e)return u(2);if(214===e)return u(4);if(215===e)return u(8);if(216===e)return u(16);if(217===e)return d(-1,1);if(218===e)return d(-1,2);if(219===e)return d(-1,4);if(220===e)return l(-1,2);if(221===e)return l(-1,4);if(222===e)return c(-1,2);if(223===e)return c(-1,4);if(e>=224&&e<=255)return e-256;throw console.debug("msgpack array:",t),new Error("Invalid byte value '"+e+"' at index "+(r-1)+" in the MessagePack binary data (length "+t.length+"): Expecting a range of 0 to 255. This is not a byte array.")}function o(e){let i=0,s=!0;for(;e-- >0;)if(s){const e=t[r++];i+=127&e,128&e&&(i-=128),s=!1}else i*=256,i+=t[r++];return i}function n(e){let i=0;for(;e-- >0;)i*=256,i+=t[r++];return i}function a(e){const i=new DataView(t.buffer,r+t.byteOffset,e);return r+=e,4===e?i.getFloat32(0,!1):8===e?i.getFloat64(0,!1):void 0}function h(e,i){e<0&&(e=n(i));const s=t.subarray(r,r+e);return r+=e,s}function c(t,e){t<0&&(t=n(e));const r={};for(;t-- >0;){r[s()]=s()}return r}function l(t,e){t<0&&(t=n(e));const r=[];for(;t-- >0;)r.push(s());return r}function d(e,i){e<0&&(e=n(i));const s=r;return r+=e,function(t,e,r){let i=e,s="";r+=e;for(;i<r;){let e=t[i++];if(e>127)if(e>191&&e<224){if(i>=r)throw new Error("UTF-8 decode: incomplete 2-byte sequence");e=(31&e)<<6|63&t[i++]}else if(e>223&&e<240){if(i+1>=r)throw new Error("UTF-8 decode: incomplete 3-byte sequence");e=(15&e)<<12|(63&t[i++])<<6|63&t[i++]}else{if(!(e>239&&e<248))throw new Error("UTF-8 decode: unknown multibyte start 0x"+e.toString(16)+" at index "+(i-1));if(i+2>=r)throw new Error("UTF-8 decode: incomplete 4-byte sequence");e=(7&e)<<18|(63&t[i++])<<12|(63&t[i++])<<6|63&t[i++]}if(e<=65535)s+=String.fromCharCode(e);else{if(!(e<=1114111))throw new Error("UTF-8 decode: code point 0x"+e.toString(16)+" exceeds UTF-16 reach");e-=65536,s+=String.fromCharCode(e>>10|55296),s+=String.fromCharCode(1023&e|56320)}}return s}(t,s,e)}function u(t,i){t<0&&(t=n(i));const s=n(1),a=h(t);switch(s){case 255:return function(t){if(4===t.length){const e=(t[0]<<24>>>0)+(t[1]<<16>>>0)+(t[2]<<8>>>0)+t[3];return new Date(1e3*e)}if(8===t.length){const r=(t[0]<<22>>>0)+(t[1]<<14>>>0)+(t[2]<<6>>>0)+(t[3]>>>2),i=(3&t[3])*e+(t[4]<<24>>>0)+(t[5]<<16>>>0)+(t[6]<<8>>>0)+t[7];return new Date(1e3*i+r/1e6)}if(12===t.length){const e=(t[0]<<24>>>0)+(t[1]<<16>>>0)+(t[2]<<8>>>0)+t[3];r-=8;const i=o(8);return new Date(1e3*i+e/1e6)}throw new Error("Invalid data length for a date value.")}(a)}return{type:s,data:a}}}var q="4.2.0";const V="color: #9E9E9E;",H="color: #9E9E9E;",X="color: #AE4292;",J=X+"font-size: 20px;font-weight: lighter",K=X+"font-size: 20px;font-weight: bold",Y=()=>{console.log("\n    %cedge%cmesh%c v4.2.0%c\n\n    Your browser is running in %cdevmode%c.\n    To re-enable edgemesh, call %cedgemesh.devmode(false)%c.%c\n\n    Need help?   %csupport@edgemesh.com%c\n    Found a Bug? %chttps://github.com/edgemesh/edgemesh/issues\n\n  ",J,K,V,H,X,H,X,H,V,X,V,X)};async function Q({host:t,topic:e,encodeData:r}){const i=new N(`Checking eligibility for node ${e}.`),s=`${t}/node/check`;i.debug("🗜 Encoding registration message.");let o={v:q,t:e};if(r)try{o=G(o),i.debug(`✅ body encoded to ${o.byteLength} bytes.`)}catch(l){throw i.error(l.body),i.end(),l}else o=JSON.stringify(o);i.log("🚀 Starting fetch.");const n=r?"application/octet-stream":"application/json",a=await fetch(s,{method:"POST",headers:{"content-type":n,accept:n},body:o});if(i.groupCollapsed("✅ Response received."),i.log(a),i.groupEnd(),200!==a.status){const t=await a.clone().text();switch(t){case"KILL_SWITCH":throw void console.log("\n    %cedge%cmesh%c v4.2.0%c\n\n    Edgemesh has experienced an outage and the global kill switch has been %cenabled%c.\n    To learn more about the outage, visit %chttps://status.edgemesh.com%c.%c\n\n    Need help?   %csupport@edgemesh.com%c\n    Found a Bug? %chttps://github.com/edgemesh/edgemesh/issues\n\n  ",J,K,V,H,X,H,X,H,V,X,V,X);case"MAINTENANCE":throw void console.log("\n    %cedge%cmesh%c v4.2.0%c\n\n    Edgemesh is currently undergoing scheduled %cmaintenance%c.\n    To learn more about this maintenance window, visit %chttps://status.edgemesh.com%c.%c\n\n    Need help?   %csupport@edgemesh.com%c\n    Found a Bug? %chttps://github.com/edgemesh/edgemesh/issues\n\n  ",J,K,V,H,X,H,X,H,V,X,V,X);case"DOMAIN_NOT_VERIFIED":throw h=document.location.hostname,void console.log(`\n    %cedge%cmesh%c v4.2.0%c\n\n    Your origin %c${h} %cis not validated.\n    Please visit the edgemesh portal at %chttps://portal.edgemesh.com%c\n    to validate your origin.%c\n\n    Need help?   %csupport@edgemesh.com%c\n    Found a Bug? %chttps://github.com/edgemesh/edgemesh/issues\n\n  `,J,K,V,H,X,H,X,H,V,X,V,X);case"DOMAIN_NOT_REGISTERED":throw(t=>{console.log(`\n    %cedge%cmesh%c v4.2.0%c\n\n    Your origin %c${t} %cis not registered.\n    Please visit the edgemesh portal at %chttps://portal.edgemesh.com%c\n    to register your origin.%c\n\n    Need help?   %csupport@edgemesh.com%c\n    Found a Bug? %chttps://github.com/edgemesh/edgemesh/issues\n\n  `,J,K,V,H,X,H,X,H,V,X,V,X)})(document.location.hostname);case"VERSION_INVALID":throw void console.log("\n    %cedge%cmesh%c v4.2.0%c\n\n    There is a new version of Edgemesh available. Your browser will update\n    automatically once you complete your current session, or you can relaunch\n    your browser to update now.%c\n\n    Need help?   %csupport@edgemesh.com%c\n    Found a Bug? %chttps://github.com/edgemesh/edgemesh/issues\n\n  ",J,K,V,H,V,X,V,X);default:throw new Error(t)}}var h;let c;i.debug("🗜 Decoding message response.");try{if(r){const t=await a.arrayBuffer();c=$(new Uint8Array(t)),i.groupCollapsed("✅ Binary response decoded.")}else c=await a.json(),i.groupCollapsed("✅ JSON response decoded.");return i.log(c),i.groupEnd(),i.end(),c}catch(l){throw i.end(),l}}const Z=2147483647,tt=t=>{"number"!=typeof t&&(t=parseFloat(t));let e=Math.round(t);return e>Z&&(e=Z),e},et={NAVIGATE:0,RELOAD:1,BACK_FORWARD:2,RESERVED:255};class rt{constructor(t={}){if(!performance||"function"!=typeof performance.getEntriesByType)return D.log("Performance API not supported by this user agent.");if(!PerformanceObserver)return D.log("PerformanceObserver not supported by this user agent.");this._getResourceData=this._getResourceData.bind(this),this._observationHandler=this._observationHandler.bind(this),this.opts=Object.assign({cachedOverride:void 0,fallbackCacheEnvelope:75,ignores:[]},t),this.clear();performance.getEntriesByType("resource").forEach(this._getResourceData),this.resourceObserver=new PerformanceObserver(this._observationHandler).observe({entryTypes:["resource"]})}clear(){this.totalAssets=0,this.accelAssets=0,this.percentAccelerated=0,this.resources={pagePath:document.location.pathname,url:[],oId:[],aId:[],cached:[],proto:[],transSize:[],encSize:[],decSize:[],type:[],startTime:[],sslTime:[],workerTime:[],fetchTime:[],tcpTime:[],dnsTime:[],reqTime:[],resTime:[],serverTiming:[]}}get(){const t=this.resources;return this.clear(),t}_observationHandler(t){const e=t.getEntries();e.length>0&&e.forEach(this._getResourceData)}_isCached(t){if(void 0!==this.opts.cachedOverride)return this.opts.cachedOverride;const e=!t.transferSize&&t.duration<this.opts.fallbackCacheEnvelope?1:0,r=t.serverTiming;if(!(r&&r.length>0))return e;{const t=r.find((t=>"emc-cached"===t.name));if(!t)return e;switch(t.description){case"precached":return 2;case"cached":return 1;case"origin":default:return 0}}}_getResourceData(t){if(!t.name)return;if(this.opts.ignores.indexOf(t.name)>-1)return;const{protocol:e,hostname:r,pathname:i,search:s}=new URL(t.name);if(!["http:","https:"].includes(e))return;const o=E(r),n=E(`${i}${s}`),a=this._isCached(t);this.totalAssets++,a&&this.accelAssets++,this.percentAccelerated=tt(this.accelAssets/this.totalAssets*100),this.resources.url.push(t.name),this.resources.oId.push(o),this.resources.aId.push(n),this.resources.cached.push(a),this.resources.proto.push(t.nextHopProtocol||"xxx"),this.resources.type.push(t.initiatorType||"xxx");const h=void 0===t.transferSize?-1:tt(t.transferSize);this.resources.transSize.push(h);const c=void 0===t.encodedBodySize?-1:tt(t.encodedBodySize);this.resources.encSize.push(c);const l=void 0===t.decodedBodySize?-1:tt(t.decodedBodySize);this.resources.decSize.push(l);const d=void 0===t.startTime?-1:tt(t.startTime);this.resources.startTime.push(d);const u=t.workerStart>0?tt(t.responseEnd-t.workerStart):t.workerStart;this.resources.workerTime.push(void 0===u?-1:u);const m=t.secureConnectionStart>0?tt(t.connectEnd-t.secureConnectionStart):t.secureConnectionStart;this.resources.sslTime.push(void 0===m?-1:m);const p=t.fetchStart>0?tt(t.responseEnd-t.fetchStart):t.fetchStart;this.resources.fetchTime.push(void 0===p?-1:p);const g=t.connectStart>0?tt(t.connectEnd-t.connectStart):t.connectStart;this.resources.tcpTime.push(void 0===g?-1:g);const f=t.domainLookupStart>0?tt(t.domainLookupEnd-t.domainLookupStart):t.domainLookupStart;this.resources.dnsTime.push(void 0===f?-1:f);const _=t.requestStart>0?tt(t.responseStart-t.requestStart):t.requestStart;this.resources.reqTime.push(void 0===_?-1:_);const y=t.responseStart>0?tt(t.responseEnd-t.responseStart):t.responseStart;this.resources.resTime.push(void 0===y?-1:y);const v=void 0===t.serverTiming?JSON.stringify([]):JSON.stringify(t.serverTiming);this.resources.serverTiming.push(v)}}const it=(t,e=-1)=>({name:t,value:e,delta:0,entries:[]}),st=(t,e)=>{try{if(PerformanceObserver.supportedEntryTypes.includes(t)){const r=new PerformanceObserver((t=>t.getEntries().map(e)));return r.observe({type:t,buffered:!0}),r}}catch(bt){}};let ot=0,nt=[];const at=window.requestAnimationFrame;let ht,ct=-1,lt=!1;function dt(){return ct}function ut(t){return t.offsetHeight>0}function mt(){ht.complete&&ut(ht)?ct=performance.now():at((()=>mt()))}at((function t(){const e=document.createNodeIterator(document.body,NodeFilter.SHOW_ALL,(function(t){if(!t)return!1;const e=t.nodeType===Node.TEXT_NODE&&/[^s]/.test(t.nodeValue.trim());if(e&&ut(t.parentNode))return e;const r=t instanceof HTMLImageElement&&""!==t.src;return!!r&&(lt=!0,r)}),!1);ht=e.nextNode(),at(null!=ht?lt?mt:()=>{ct=performance.now()}:t)}));const pt=i((function(t){var e=function(){var t=String.fromCharCode,e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",i={};function s(t,e){if(!i[t]){i[t]={};for(var r=0;r<t.length;r++)i[t][t.charAt(r)]=r}return i[t][e]}var o={compressToBase64:function(t){if(null==t)return"";var r=o._compress(t,6,(function(t){return e.charAt(t)}));switch(r.length%4){default:case 0:return r;case 1:return r+"===";case 2:return r+"==";case 3:return r+"="}},decompressFromBase64:function(t){return null==t?"":""==t?null:o._decompress(t.length,32,(function(r){return s(e,t.charAt(r))}))},compressToUTF16:function(e){return null==e?"":o._compress(e,15,(function(e){return t(e+32)}))+" "},decompressFromUTF16:function(t){return null==t?"":""==t?null:o._decompress(t.length,16384,(function(e){return t.charCodeAt(e)-32}))},compressToUint8Array:function(t){for(var e=o.compress(t),r=new Uint8Array(2*e.length),i=0,s=e.length;i<s;i++){var n=e.charCodeAt(i);r[2*i]=n>>>8,r[2*i+1]=n%256}return r},decompressFromUint8Array:function(e){if(null==e)return o.decompress(e);for(var r=new Array(e.length/2),i=0,s=r.length;i<s;i++)r[i]=256*e[2*i]+e[2*i+1];var n=[];return r.forEach((function(e){n.push(t(e))})),o.decompress(n.join(""))},compressToEncodedURIComponent:function(t){return null==t?"":o._compress(t,6,(function(t){return r.charAt(t)}))},decompressFromEncodedURIComponent:function(t){return null==t?"":""==t?null:(t=t.replace(/ /g,"+"),o._decompress(t.length,32,(function(e){return s(r,t.charAt(e))})))},compress:function(e){return o._compress(e,16,(function(e){return t(e)}))},_compress:function(t,e,r){if(null==t)return"";var i,s,o,n={},a={},h="",c="",l="",d=2,u=3,m=2,p=[],g=0,f=0;for(o=0;o<t.length;o+=1)if(h=t.charAt(o),Object.prototype.hasOwnProperty.call(n,h)||(n[h]=u++,a[h]=!0),c=l+h,Object.prototype.hasOwnProperty.call(n,c))l=c;else{if(Object.prototype.hasOwnProperty.call(a,l)){if(l.charCodeAt(0)<256){for(i=0;i<m;i++)g<<=1,f==e-1?(f=0,p.push(r(g)),g=0):f++;for(s=l.charCodeAt(0),i=0;i<8;i++)g=g<<1|1&s,f==e-1?(f=0,p.push(r(g)),g=0):f++,s>>=1}else{for(s=1,i=0;i<m;i++)g=g<<1|s,f==e-1?(f=0,p.push(r(g)),g=0):f++,s=0;for(s=l.charCodeAt(0),i=0;i<16;i++)g=g<<1|1&s,f==e-1?(f=0,p.push(r(g)),g=0):f++,s>>=1}0==--d&&(d=Math.pow(2,m),m++),delete a[l]}else for(s=n[l],i=0;i<m;i++)g=g<<1|1&s,f==e-1?(f=0,p.push(r(g)),g=0):f++,s>>=1;0==--d&&(d=Math.pow(2,m),m++),n[c]=u++,l=String(h)}if(""!==l){if(Object.prototype.hasOwnProperty.call(a,l)){if(l.charCodeAt(0)<256){for(i=0;i<m;i++)g<<=1,f==e-1?(f=0,p.push(r(g)),g=0):f++;for(s=l.charCodeAt(0),i=0;i<8;i++)g=g<<1|1&s,f==e-1?(f=0,p.push(r(g)),g=0):f++,s>>=1}else{for(s=1,i=0;i<m;i++)g=g<<1|s,f==e-1?(f=0,p.push(r(g)),g=0):f++,s=0;for(s=l.charCodeAt(0),i=0;i<16;i++)g=g<<1|1&s,f==e-1?(f=0,p.push(r(g)),g=0):f++,s>>=1}0==--d&&(d=Math.pow(2,m),m++),delete a[l]}else for(s=n[l],i=0;i<m;i++)g=g<<1|1&s,f==e-1?(f=0,p.push(r(g)),g=0):f++,s>>=1;0==--d&&(d=Math.pow(2,m),m++)}for(s=2,i=0;i<m;i++)g=g<<1|1&s,f==e-1?(f=0,p.push(r(g)),g=0):f++,s>>=1;for(;;){if(g<<=1,f==e-1){p.push(r(g));break}f++}return p.join("")},decompress:function(t){return null==t?"":""==t?null:o._decompress(t.length,32768,(function(e){return t.charCodeAt(e)}))},_decompress:function(e,r,i){var s,o,n,a,h,c,l,d=[],u=4,m=4,p=3,g="",f=[],_={val:i(0),position:r,index:1};for(s=0;s<3;s+=1)d[s]=s;for(n=0,h=Math.pow(2,2),c=1;c!=h;)a=_.val&_.position,_.position>>=1,0==_.position&&(_.position=r,_.val=i(_.index++)),n|=(a>0?1:0)*c,c<<=1;switch(n){case 0:for(n=0,h=Math.pow(2,8),c=1;c!=h;)a=_.val&_.position,_.position>>=1,0==_.position&&(_.position=r,_.val=i(_.index++)),n|=(a>0?1:0)*c,c<<=1;l=t(n);break;case 1:for(n=0,h=Math.pow(2,16),c=1;c!=h;)a=_.val&_.position,_.position>>=1,0==_.position&&(_.position=r,_.val=i(_.index++)),n|=(a>0?1:0)*c,c<<=1;l=t(n);break;case 2:return""}for(d[3]=l,o=l,f.push(l);;){if(_.index>e)return"";for(n=0,h=Math.pow(2,p),c=1;c!=h;)a=_.val&_.position,_.position>>=1,0==_.position&&(_.position=r,_.val=i(_.index++)),n|=(a>0?1:0)*c,c<<=1;switch(l=n){case 0:for(n=0,h=Math.pow(2,8),c=1;c!=h;)a=_.val&_.position,_.position>>=1,0==_.position&&(_.position=r,_.val=i(_.index++)),n|=(a>0?1:0)*c,c<<=1;d[m++]=t(n),l=m-1,u--;break;case 1:for(n=0,h=Math.pow(2,16),c=1;c!=h;)a=_.val&_.position,_.position>>=1,0==_.position&&(_.position=r,_.val=i(_.index++)),n|=(a>0?1:0)*c,c<<=1;d[m++]=t(n),l=m-1,u--;break;case 2:return f.join("")}if(0==u&&(u=Math.pow(2,p),p++),d[l])g=d[l];else{if(l!==m)return null;g=o+o.charAt(0)}f.push(g),d[m++]=o+g.charAt(0),o=g,0==--u&&(u=Math.pow(2,p),p++)}}};return o}();null!=t&&(t.exports=e)})).compressToBase64,gt=navigator.userAgent.toLowerCase().indexOf("firefox")>-1;class ft{constructor(t={}){if(!t.nodeId)throw new Error("opts.nodeId is required.");if(!t.topic)throw new Error("opts.topic is required.");if(!t.host)throw new Error("opts.host is required.");this.host=t.host,this.endpoint=`${this.host}/node`,this.opts=t,this.resources=new rt({cachedOverride:t.cachedOverride}),this.getNavigation=()=>function(){const t=window.performance;let e,r,i,s,o={};if(t)return"function"==typeof t.getEntriesByType&&(e=t.getEntriesByType("navigation"),e&&e.length?(D.debug("This user agent supports NavigationTiming2."),e=e[0],r=e.startTime,i=e.domContentLoadedEventStart,s=t.now()-r):e=void 0),!e&&t.timing&&(D.debug("This user agent supports NavigationTiming."),e=t.timing,r=e.navigationStart,i=e.domLoading,s=+new Date-r),e&&(o={url:document.location.href,tcpTime:tt(e.connectEnd-e.connectStart),dnsTime:tt(e.domainLookupEnd-e.domainLookupStart),reqTime:tt(e.responseStart-e.requestStart),resTime:tt(e.responseEnd-e.responseStart),fetchTime:tt(e.responseEnd-e.fetchStart),unloadTime:tt(e.unloadEventEnd-e.unloadEventStart),ttfb:tt(e.responseStart-r),startRender:tt(i-r),contentLoaded:tt(e.domContentLoadedEventEnd-r),interactive:tt(e.domInteractive-r),pageLoad:tt(e.domComplete-r),timeOnPage:tt(s)},e.type?o.navType=et[e.type.toUpperCase()]:t.navigation&&(o.navType=t.navigation.type),document.referrer&&(o.referrer=document.referrer),void 0!==e.secureConnectionStart&&void 0!==e.connectEnd&&(o.sslTime=e.secureConnectionStart>0?tt(e.connectEnd-e.secureConnectionStart):e.secureConnectionStart),void 0!==e.workerStart&&void 0!==e.responseEnd&&(o.workerTime=e.workerStart>0?tt(e.responseEnd-e.workerStart):e.workerStart),void 0!==e.encodedBodySize&&(o.encSize=e.encodedBodySize),void 0!==e.decodedBodySize&&(o.decSize=e.decodedBodySize),void 0!==e.transferSize&&(o.transSize=e.transferSize),e.nextHopProtocol&&(o.proto=e.nextHopProtocol)),e&&(e.requestStart&&e.navigationStart&&e.requestStart<e.navigationStart||e.responseStart&&e.navigationStart&&e.responseStart<e.navigationStart||e.responseStart&&e.fetchStart&&e.responseStart<e.fetchStart||e.navigationStart&&e.fetchStart<e.navigationStart)&&(o.bad=!0),o}(),this.getOnLoad=(()=>{let t=-1;const e={capture:!0,passive:!0},r=()=>{t=performance.now(),window.onpageshow?window.removeEventListener("pageshow",r,e):window.removeEventListener("load",r,e)};return"complete"===document.readyState?t=performance.now():window.onpageshow?window.addEventListener("pageshow",r,e):window.addEventListener("load",r,e),()=>(t>Number.MAX_SAFE_INTEGER&&(t=Number.MAX_SAFE_INTEGER),{onLoad:t})})(),this.getCLS=(()=>{const t=it("CLS",0);return st("layout-shift",(e=>{if(!e.hadRecentInput){const r=nt[0],i=nt[nt.length-1];ot&&e.startTime-i.startTime<1e3&&e.startTime-r.startTime<5e3?(ot+=e.value,nt.push(e)):(ot=e.value,nt=[e]),ot>t.value&&(t.value=ot,t.entries=nt)}})),()=>0===t?-1:t})(),this.getFCP=(()=>{const t=it("FCP");if(PerformanceObserver.supportedEntryTypes.indexOf("paint")>=0)return st("paint",(e=>{"first-contentful-paint"===e.name&&(t.value=e.startTime,t.entries.push(e))})),()=>t;return()=>{const e=dt();return t.value=e,t}})(),this.getFID=(()=>{const t=it("FID");return st("first-input",(e=>{t.value=e.processingStart-e.startTime,t.entries.push(e)}))||window.perfMetrics&&window.perfMetrics.onFirstInputDelay&&window.perfMetrics.onFirstInputDelay(((e,r)=>{t.value=e,t.entries=[{entryType:"first-input",name:r.type,target:r.target,cancelable:r.cancelable,startTime:r.timeStamp,processingStart:r.timeStamp+e}]})),()=>t})(),this.getLCP=(()=>{const t=it("LCP");return st("largest-contentful-paint",(e=>{t.value=e.startTime,t.entries.push(e)})),()=>t})(),this.getTBT=(()=>{const t=it("TBT",0);let e=[];return new PerformanceObserver((function(t){e=[...e,...t.getEntries()]})).observe({entryTypes:["longtask"]}),r=>(t.value=e.reduce(((t,e)=>{if(e.startTime<r&&e.startTime+e.duration>=r){const i=e.duration-(r-e.startTime);return i>=50&&(t+=i-50),t}return t+(e.duration-50)}),0),t)})(),this.getFirstCPUIdle=(()=>{let t=-1;if(window.requestIdleCallback){const e=window.requestIdleCallback((()=>{t=performance.now(),window.cancelIdleCallback(e)}))}return()=>({firstCPUIdle:t})})(),this.getInputDelay=(()=>{let t=-1,e=-1,r=-1,i=-1;const s={passive:!0,capture:!0},o=()=>{t=performance.now(),t>Number.MAX_SAFE_INTEGER&&(t=Number.MAX_SAFE_INTEGER),window.removeEventListener("mousedown",o,s)},n=()=>{e=performance.now(),e>Number.MAX_SAFE_INTEGER&&(e=Number.MAX_SAFE_INTEGER),window.removeEventListener("scroll",n,s)},a=()=>{r=performance.now(),r>Number.MAX_SAFE_INTEGER&&(r=Number.MAX_SAFE_INTEGER),window.removeEventListener("keypress",a,s)},h=()=>{i=performance.now(),i>Number.MAX_SAFE_INTEGER&&(i=Number.MAX_SAFE_INTEGER),window.removeEventListener("mousemove",h,s)};return window.addEventListener("mousedown",o,s),window.addEventListener("scroll",n,s),window.addEventListener("keypress",a,s),window.addEventListener("mousemove",h,s),()=>({firstClick:t,firstScroll:e,firstKeypress:r,firstMousemove:i})})();const e=window;e.onpagehide||null===e.onpagehide?e.addEventListener("pagehide",this._handleUnload.bind(this)):e.addEventListener("beforeunload",this._handleUnload.bind(this))}_handleUnload(){const t=this.getNavigation(),e=this.resources.totalAssets,r=this.resources.accelAssets,i=this.resources.percentAccelerated,s=this.resources.get(),o=this.getCLS(),n=this.getFCP(),a=this.getFID(),h=this.getLCP(),c=this.getTBT(n.value),l=this.getInputDelay(),{firstCPUIdle:d}=this.getFirstCPUIdle(),{onLoad:u}=this.getOnLoad(),m={v:q,t:this.opts.topic,nId:this.opts.nodeId},p={total:e,accel:r,cls:o.value,fcp:tt(n.value),fid:tt(a.value),lcp:tt(h.value),tbt:tt(c.value),onLoad:tt(u),cpuIdle:tt(d),firstClick:tt(l.firstClick),firstScroll:tt(l.firstScroll),firstMousemove:tt(l.firstMousemove),firstKeypress:tt(l.firstKeypress)},g=Object.assign({},m,p,t),f=Object.assign({},m,s);if(gt){const t=[pt(JSON.stringify(g))];if(navigator.sendBeacon(`${this.endpoint}/navigation`,t)?D.log("✅ Edgemesh navigation analytics event sent via beacon."):D.error("❌ Error sending Edgemesh navigation analytics via beacon."),f.url.length){const t=[pt(JSON.stringify(f))];navigator.sendBeacon(`${this.endpoint}/resources`,t)?D.log("✅ Edgemesh resource analytics event sent via beacon."):D.error("❌ Error sending Edgemesh resource analytics via beacon.")}}else fetch(`${this.endpoint}/navigation`,{method:"POST",headers:{"content-type":"application/octet-stream"},keepalive:!0,credentials:"omit",body:G(g)}).then((()=>{D.log("✅ Edgemesh navigation analytics event sent via fetch keepalive.")})).catch((t=>{D.error("❌ Error sending Edgemesh navigation analytics via fetch keepalive.",t)})),f.url.length&&fetch(`${this.endpoint}/resources`,{method:"POST",headers:{"content-type":"application/octet-stream"},keepalive:!0,credentials:"omit",body:G(f)}).then((()=>{D.log("✅ Edgemesh resource analytics event sent via fetch keepalive.")})).catch((t=>{D.error("❌ Error sending Edgemesh resource analytics via fetch keepalive.",t)}));if(!this.opts.disableGA&&window.ga&&"function"==typeof window.ga&&"function"==typeof window.ga.getAll){const t=window.ga.getAll();t.length&&(t.forEach((t=>{const e=t.get("name");window.ga(`${e}.send`,"event",{eventCategory:"Edgemesh",eventAction:"Percent Accelerated",eventLabel:String(i),nonInteraction:!0})})),D.log("✅ Google analytics event sent."))}}}const _t="em-log-level",yt="em-id",vt="em-encode",wt="em-devmode",At={serviceWorker:Boolean(window.ServiceWorker),localStorage:Boolean(window.localStorage),iddb:Boolean(window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB),crypto:Boolean(window.crypto)};return class{constructor(r={}){this.version=q,this.host=r.host||"https://api.edgeme.sh",this.swUrl=r.swUrl||"/sw.js",this.scope=r.scope||"/",this.lite=r.lite||!1,this.externalMount=r.externalMount||!1,this.softDisable=void 0!==r.softDisable?r.softDisable:this.externalMount,this.disableGA=r.disableGA||!1,this.topicDepth=r.topicDepth||0,this._ready=!1,this._encodeData=!0,this._disable=this._disable.bind(this),x="client";const i=parseInt(localStorage.getItem(_t),10);i>=0&&i<=Object.keys(e).length-1?this.setLogLevel(i):this.setLogLevel(e.silent);if(localStorage.getItem(wt))return Y(),void this._disable();const s=localStorage.getItem(yt);s?this._nodeId=s:(this._nodeId=t(),localStorage.setItem(yt,this._nodeId));const o=localStorage.getItem(vt);if(o?this._encodeData="false"!==o||!1:(this._encodeData=!0,localStorage.setItem(vt,this._encodeData)),this.topicDepth>0){const t=[document.location.hostname].concat(document.location.pathname.split("/").slice(1,this.topicDepth+1)).join("/");this._topic=E(t)}else this._topic=E(document.location.hostname);if(!function(){let t=!0;return Object.keys(At).forEach((e=>{At[e]||(t=!1)})),t}())return D.log("The current browser is not supported by Edgemesh."),void this._startMetrics({cacheOverride:0});this._start()}async _start(){try{const{config:t,purgeTimestamp:r,integrations:i}=await Q({host:this.host,topic:this._topic,encodeData:this._encodeData}),s=localStorage.getItem("em-last-purged")||"0";if(r>parseInt(s,10)){const t=await caches.open("edgemesh/assets"),e=await t.keys();for(const r of e)await t.delete(r);localStorage.setItem("em-last-purged",+new Date)}const{level:o,name:n}=this.getLogLevel();o!==e.silent&&((t,e,r)=>{console.log(`\n    %cEdge%cmesh%c\n\n    Version:     %c4.2.0%c\n    Level:       %c${e}%c\n    Host:        %c${t}%c\n    Scope:       %c${r}%c\n    Need help?   %csupport@edgemesh.com%c\n    Found a Bug? %chttps://github.com/edgemesh/edgemesh/issues\n\n  `,J,K,H,"color: #B4A454;",H,"color: #009688;",H,X,H,X,V,X,V,X)})(this.host,n,this.scope),this._enable(t),i.length>0&&this._addIntegrations(i)}catch(t){this._disable(t)}}_enable(t){D.log("Enabling edgemesh.");const e=(t>>>0).toString(2).padStart(32,0).split("").map((t=>parseInt(t,10)));e[30]?(D.log("Edgemesh is disabled. Service will not start."),P.unregister()):e[31]?(D.log("Edgemesh is paused. Service will not start."),P.unregister()):this.lite||e[20]?(D.log("Edgemesh started in lite mode."),P.unregister(),this._startMetrics({cachedOverride:0})):this.externalMount?(this._startMetrics(),D.log("External mount is set. Locating registered service worker."),this._sw=new j,this._sw.addEventListener("activated",(()=>{D.log("Service worker activated."),this._startServices(t)})),this._sw.addEventListener("ready",(()=>{D.log("Service worker ready."),this._startServices(t)}))):(this._startMetrics(),D.log("Registering service worker."),this._sw=new P(this.swUrl,{scope:this.scope}),this._sw.addEventListener("waiting",(()=>{console.log("A new service worker has installed, but it can't activate until all tabs running the current version have been closed.")})),this._sw.addEventListener("activated",(()=>{D.log("Service worker activated."),this._startServices(t)})),this._sw.addEventListener("ready",(()=>{D.log("Service worker ready."),this._startServices(t)})),this._sw.register().catch(this._disable))}_disable(t){t&&D.error(t),this.softDisable?navigator.serviceWorker.controller?navigator.serviceWorker.controller.postMessage({channel:"SOFT_DISABLE"}):D.warn("Service Worker Controller not ready yet."):navigator.serviceWorker.controller&&P.unregister(),D.log("Edgemesh service disabled.")}_startServices(t){try{this._sw.messageSW({channel:"SET_CONFIG",data:{config:t,host:this.host,topic:this._topic,nodeId:this._nodeId,level:this.getLogLevel().level,encoded:this._encodeData}}).catch(D.error)}catch(e){return D.error(e)}}_startMetrics(t={}){this._metrics=new ft(Object.assign({nodeId:this._nodeId,topic:this._topic,host:this.host,encodeData:this._encodeData,disableGA:this.disableGA},t)),this._ready=!0}_addIntegrations(t=[]){t.forEach((({src:t,async:e,defer:r})=>{if(void 0===t)return D.error("❌ Integration script has an undefined src.");const i=document.createElement("script");i.type="text/javascript",i.src=t,void 0!==e&&(i.async=e),void 0!==r&&(i.defer=r),document.head.append(i)}))}get LOG_LEVELS(){return e}getLogLevel(){const t=L;return{level:t,name:Object.keys(e)[t]}}setLogLevel(t){if("number"!=typeof t)return console.error('Log level must be a number. Use "edgemesh.LOG_LEVELS".');const r=Object.keys(e)[t];if(!r)return console.error('Must be a valid log level. Use "edgemesh.LOG_LEVELS".');localStorage.setItem(_t,t),L=t,D.log(`Setting log level to ${r}.`),this._sw&&this._sw.messageSW({channel:"SET_LEVEL",data:{level:t,name:r}})}debug(t=!1){return t?localStorage.setItem(vt,!1):localStorage.setItem(vt,!0),this._sw&&this._sw.messageSW({channel:"SET_DEBUG",data:{encoded:t}}),setTimeout((()=>{window.location.reload()}),200),`edgemesh debug set to ${t}`}devmode(t=!1){return t?(Y(),localStorage.setItem(wt,!0),this._disable()):localStorage.removeItem(wt),setTimeout((()=>{window.location.reload()}),200),`edgemesh devmode set to ${t}`}stats(){const t=this._ready,e=this._sw&&this._sw._sw,r=Boolean(e&&"activated"===e.state),i=this._metrics&&this._metrics.resources;return{ready:t,workerEnabled:r,percentAccelerated:i?i.percentAccelerated:0,cacheHitCount:i?i.accelAssets:0,cacheMissCount:i?i.totalAssets-i.accelAssets:0}}async flare(){const t=async()=>{try{await navigator.clipboard.writeText(JSON.stringify(Object.assign({nodeId:this._nodeId,topic:this._topic,version:this.version,userAgent:navigator.userAgent,href:document.location.href,config:{host:this.host,swUrl:this.swUrl,scope:this.scope,lite:this.lite,externalMount:this.externalMount,softDisable:this.softDisable,disableGA:this.disableGA,topicDepth:this.topicDepth},devmode:Boolean(localStorage.getItem(wt)),encodeData:Boolean(localStorage.getItem(vt)),logLevel:this.getLogLevel()},this.stats()))),console.log("✅ Edgemesh Flare copied to clipboard.")}catch(e){console.log("❌ Error copying Edgemesh Flare to clipboard.",e)}window.removeEventListener("focus",t)};return window.addEventListener("focus",t),console.log("🔎 Focus the document to copy the flare."),"_"}}}();
